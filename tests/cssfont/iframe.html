<!doctype html>
<html>
<head>
</head>
<body>
<div id="inference" style="display:inline-block;position:absolute;">H</div>

<script>

  var doc = document, width = null;
  var fixture = doc.getElementById("inference");
  var clone = fixture.cloneNode(true);
  var fake = fixture.cloneNode(true);

  doc.body.appendChild( clone );
  doc.body.appendChild( fake );

  clone.style.cssText += "font-family: GothicCustom;";
  fake.style.cssText += "font-family: OHHAI!!!;";

  // Use Google WebFont Loader to load fonts
  // https://developers.google.com/webfonts/docs/webfont_loader
  WebFontConfig = {
    custom: { families: ['GothicCustom', 'OHHAI!!!'], 
              urls: ['fontface.css']
    },
    active: function() {
      var orig = parseInt( doc.defaultView.getComputedStyle( fixture ).getPropertyValue("width"), 10 ),
          font = parseInt( doc.defaultView.getComputedStyle( clone ).getPropertyValue("width"), 10 ),
          control = parseInt( doc.defaultView.getComputedStyle( fake ).getPropertyValue("width"), 10 );

      // The font we have chosen to use should be narrower then the default font
      // of any given UA. This is presumptuous, but pretty close for now.
      // TODO: Refined control over the default/starting font
      //
      
      // IE9Mobile does not support arbitrary object messages,
      // serialize first
      top.postMessage(JSON.stringify({
        which: "practical",
        results: [
          {
            desc: "Custom font supported",
            result: font !== orig
          },
          {
            desc: "Custom font distinguished from non-custom",
            result: font !== control
          }
        ]
      }), "*");
    }
  };

  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
        '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();

</script>
</body>
</html>
